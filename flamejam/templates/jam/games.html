{% extends "jam/base.html" %}

{% block title %}Games of {{ jam.title }}{% endblock %}

{% block subbreadcrumb %}
    <li><a href="#">Games</a></li>
{% endblock %}

{% block content %}

<h1>Games</h1>

{% if jam.games.all() | length == 0 %}
    <p>There are no games yet.</p>
{% else %}
    {% if jam.getStatus().code <= 4 %}
        <div class="alert alert-info">This list is randomly shuffled while ratings are hidden.</div>
    {% endif %}

    <table class="tabular full">
        <tr class="sorters">
            <th></th>
            <th>Game Title</th>
            <th>Team</th>
            <th>Members</th>
            <th>Screenshots</th>
            <th class="nosort">Download</th>
            <th>Rating (you)</th>
            <th></th>
        </tr>
        {% set games = (jam.getShuffledGames() if jam.getStatus().code <= 4 else jam.getTopGames()) %}
        {% for game in games %}
        <tr>
            <td>{{ loop.index }}</th>
            <td><a href="{{ game.url() }}">{{ game.title }}</a></th>
            <td><a href="{{ game.team.url() }}">{{ game.team.name }}</a></td>
            <td data-value="{{ game.team.members | length }}">
                {% for m in game.team.members %}
                <a href="{{ m.url() }}">{{ m.username }}</a>
                {% endfor %}
            </th>
            <td>{{ game.screenshots.count() }}</th>
            <td><a href="#">Linux</a> | <a href="#">MacOS X</a> </th>
            <td>
                {% if jam.getStatus().code <= 3 %}
                    n/a <!-- before rating -->
                {% else  %}
                    {% if jam.getStatus().code >= 5 %}
                        {{ game.getAverageRating() }}
                    {% else %}
                        n/a
                    {% endif %}
                    &ndash;

                    {% set r = current_user.ratings.filter_by(game = game).first() if current_user.is_authenticated() else None %}
                    {% if r %}
                        {{ r.getAverage() }}
                    {% elif jam.getStatus().code == 4 %}
                        <a href="#">rate now</a>
                    {% else %}
                        n/a
                    {% endif %}
                {% endif %}
            </td>
            <td></td>
        </tr>
        {% endfor %}
    </table>
    </ul>
{% endif %}

{% endblock %}
